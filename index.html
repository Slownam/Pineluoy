<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Create Server via VSUNSEE API (WORKING)</title>
  <style>
    body{font-family:Inter,Arial,system-ui;background:#f7fafc;color:#0f172a;padding:20px}
    .card{background:#fff;border-radius:8px;padding:18px;max-width:720px;margin:20px auto;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
    input,select,button,textarea{width:100%;padding:10px;margin:8px 0;border:1px solid #e6eef6;border-radius:8px}
    label{font-weight:700;font-size:13px}
    button{background:#2563eb;color:#fff;border:0;cursor:pointer;padding:10px;border-radius:8px}
    pre{background:#0b1220;color:#e6eef8;padding:12px;border-radius:8px;overflow:auto}
    .muted{color:#64748b;font-size:13px}
  </style>
</head>
<body>
  <div class="card">
    <h3>Create Server 2 (via apiz.vsunsee.sbs)</h3>
    <p class="muted">Isi **Nama** dan pilih paket **RAM**. Sistem akan membuat email/password otomatis lalu memanggil endpoint VSUNSEE.</p>

    <form id="form">
      <label>Nama (digunakan untuk username & nameserver)</label>
      <input id="name" name="name" placeholder="misal: rizky" required />

      <label>Pilih Paket RAM</label>
      <select id="package" name="package">
        <option value="1gb">1GB</option>
        <option value="2gb">2GB</option>
        <option value="3gb">3GB</option>
        <option value="4gb">4GB</option>
        <option value="5gb">5GB</option>
        <option value="6gb">6GB</option>
        <option value="7gb">7GB</option>
        <option value="8gb">8GB</option>
        <option value="9gb">9GB</option>
        <option value="10gb">10GB</option>
        <option value="unlimited">Unlimited</option>
        <option value="unli">Unli</option>
      </select>

      <div style="margin-top:8px;">
        <button type="submit">Buat via API</button>
      </div>
    </form>

    <div id="result" style="display:none;margin-top:12px;">
      <h4>Informasi Akun (lokal)</h4>
      <div id="creds"></div>

      <h4 style="margin-top:8px">Response API</h4>
      <pre id="apiResp">-</pre>
    </div>

    <p class="muted" style="margin-top:12px">
      <strong>PENTING:</strong> Edit `settings.js` untuk mengisi parameter: <code>Domain</code> (panel domain), <code>ptla</code> (apikey ptero), <code>ptlc</code> (capikey ptero).  
      Endpoint eksternal ini bisa mengembalikan error CORS jika tidak mengizinkan origin â€” kalau muncul CORS, gunakan proxy server.
    </p>
  </div>

<script src="settings.js"></script>
<script>
  // Ambil konfigurasi dari settings.js
  const VS_BASE = 'https://apiz.vsunsee.sbs/vsunseeV8/create';
  const DomainVal = window.Domain || '';   // param domain untuk API (isikan panel domain jika perlu)
  const apikeyPtero = window.ptla || '';   // akan diisi ke query apikeyptero
  const capiKeyPtero = window.ptlc || '';  // akan diisi ke query capikeyptero
  const useRootAdmin = (typeof window.rootadmin !== 'undefined') ? !!window.rootadmin : false; // optional override

  // resource mapping sama seperti di snippet WA-mu
  const resourceMap = {
    "1gb":  { ram: 1000,  disk: 1000,  cpu: 40 },
    "2gb":  { ram: 2000,  disk: 1000,  cpu: 60 },
    "3gb":  { ram: 3000,  disk: 2000,  cpu: 80 },
    "4gb":  { ram: 4000,  disk: 2000,  cpu: 100 },
    "5gb":  { ram: 5000,  disk: 3000,  cpu: 120 },
    "6gb":  { ram: 6000,  disk: 3000,  cpu: 140 },
    "7gb":  { ram: 7000,  disk: 4000,  cpu: 160 },
    "8gb":  { ram: 8000,  disk: 4000,  cpu: 180 },
    "9gb":  { ram: 9000,  disk: 5000,  cpu: 200 },
    "10gb": { ram:10000,  disk: 5000,  cpu: 220 },
    "unlimited": { ram: 0, disk: 0, cpu: 0 },
    "unli":      { ram: 0, disk: 0, cpu: 0 }
  };

  function rand3(){ return String(Math.floor(Math.random()*900)+100); }
  function sanitize(u){ return u.trim().toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9-_\.]/g,''); }
  function capitalize(s){ if(!s) return s; return s[0].toUpperCase()+s.slice(1); }
  function show(el){ el.style.display = 'block'; }

  document.getElementById('form').addEventListener('submit', async (e) => {
    e.preventDefault();
    if(!VS_BASE){ alert('Internal error: VS_BASE tidak ter-set'); return; }
    if(!DomainVal){ alert('ERROR: settings.js -> Domain belum di-set'); return; }
    if(!apikeyPtero){ alert('ERROR: settings.js -> ptla (apikey ptero) belum di-set'); return; }
    if(!capiKeyPtero){ alert('ERROR: settings.js -> ptlc (capikey ptero) belum di-set'); return; }

    const raw = document.getElementById('name').value || '';
    if(!raw.trim()){ alert('Isi nama dulu'); return; }
    const pkg = document.getElementById('package').value || '1gb';
    const map = resourceMap[pkg] || resourceMap['unlimited'];

    const username = sanitize(raw);
    const email = username + '@gmail.com';   // sesuai permintaan
    const password = username + rand3();     // nama + 3 digit
    const nameserver = sanitize(raw);       // kita kirim nameserver = nama (bisa diubah)
    const disk = map.disk;                  // sesuai mapping
    const cpu = map.cpu;

    // tampilkan kredensial lokal dulu
    const resultBox = document.getElementById('result');
    const credsEl = document.getElementById('creds');
    const apiRespEl = document.getElementById('apiResp');
    credsEl.innerHTML = `<strong>Email/username:</strong> ${email}<br><strong>Password:</strong> ${password}<br><strong>Nameserver:</strong> ${nameserver}<br><strong>RAM:</strong> ${map.ram===0?'Unlimited':map.ram+' MB'}`;
    show(resultBox);
    apiRespEl.textContent = 'Mengirim request ke API...';

    try {
      // build query params sesuai endpoint yang kamu berikan
      const params = new URLSearchParams({
        domain: DomainVal,
        apikeyptero: apikeyPtero,
        capikeyptero: capiKeyPtero,
        nameserver: nameserver,
        password: password,
        disk: String(disk),
        cpu: String(cpu),
        rootadmin: String(useRootAdmin) // default false
      });

      const url = VS_BASE + '?' + params.toString();

      // NOTE: endpoint ini menggunakan GET dengan query string
      const resp = await fetch(url, {
        method: 'GET',
        headers: { 'Accept': 'application/json' }
      });

      const text = await resp.text();
      try {
        const j = JSON.parse(text);
        apiRespEl.textContent = JSON.stringify(j, null, 2);
      } catch (e) {
        apiRespEl.textContent = text;
      }

      if(!resp.ok){
        apiRespEl.textContent = `Request gagal, HTTP ${resp.status}\\n` + apiRespEl.textContent;
      }
    } catch (err) {
      apiRespEl.textContent = 'Terjadi kesalahan saat request: ' + err.message;
    }
  });
</script>
</body>
</html>
